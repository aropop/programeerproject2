% !TeX spellcheck = nl_BE
\documentclass{article}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\newcommand{\thedate}{2 Juni 2014}
\newcommand{\projectname}{ProgrammeerProject 2}
\title{Codeverslag Programmeerproject 2}
\author{Arno De Witte\\
Vrije Universiteit Brussel}
\date{2 Juni 2014}
\begin{document}


\begin{titlepage}
\begin{center}

\includegraphics[width=0.60\textwidth]{./VUB_logo_compact.jpg}~\\[1cm]


\textsc{\Large Programmeerproject 2}\\[0.5cm]

% Title
\HRule \\[0.4cm]
{ \huge \bfseries Codeverslag}\\[0.4cm]

\HRule \\[1.5cm]

% Author and supervisor
\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
Arno \textsc{De Witte}\\
\end{flushleft}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\begin{flushright} \large
\emph{Titularis:}\\ Prof. Dr. Theo Dâ€™Hondt\\
\emph{Assistenten:}\\ Kevin Van Vaerenbergh\\
Lode Hoste\\
Yves Vandriessche
\end{flushright}
\end{minipage}

\vfill

% Bottom of the page
{\large \thedate}

\end{center}
\end{titlepage}

%\maketitle
\newpage
\tableofcontents
\newpage


\section{Inleiding}\label{inleiding}
In dit document kan er een handleiding voor gebruikers en een handleiding voor ontwikkelaars gevonden worden. De handleiding voor gebruikers bevat een overzicht van hoe je het systeem moet gebruiken. De handleiding voor ontwikkelaars bespreekt elk onderdeel van de code uitvoerig.\\
Het systeem draagt de naam Control Your House omdat je ermee heel je huis kan bedienen van achter je computer. Verder is het systeem geschreven in het Engels. Zowel de code, commentaar maar ook de interface. De handleiding in dit document is wel in het Nederlands.\\
De code is meegeleverd in hetzelfde archief als waarin dit document kan worden gevonden en is voornamelijk geschreven in Racket, met onderdelen in slip en R5RS.\\
Het doel van dit project is om een domotica systeem te schrijven. Dit systeem bestaat uit 3 delen. Een majordomo: dit is een computer die heel het systeem beheert, een steward: dit zijn kleine computers (bijvoorbeeld een raspberry pi) die commando's krijgen over een lokaal netwerk en deze dan doorsturen naar de devices. De devices zijn het laatste deel, dit zijn slimme apparaten die via het Zigbee protocol verschillende boodschappen (messages) verstaan. Ze kunnen deze uitvoeren en een antwoord terugsturen.\\

\section{Handleiding voor gebruikers}
\label{sec:users}
In dit deel zal er worden uitgelegd hoe je het systeem gebruikt. Er is een opsomming van de functies\ref{sub:features}, hoe het systeem ge\"{i}nstalleerd moet worden\ref{sub:install} en hoe alle functies gebruikt kunnen worden\ref{sub:usage}.

\subsection{Functies}
\label{sub:features}
\begin{itemize}
\item Een simpele, overzichtelijke web interface die kan worden bekeken op alle toestellen die over een browser beschikken en binnen hetzelfde netwerk zitten.
\item Overzicht van alle stewards, met een actuele status. Deze toont aan wanneer bepaalde stewards offline zijn (niet verbonden met netwerk) of hoeveel devices er geconnecteerd zijn aan een bepaalde steward.
\item Mogelijkheid om nieuwe stewards toe te voegen. Je hoeft enkel het ip adres, de poort en de plaats van de steward mee te geven.
\item Automatisch opsporen van devices door de steward. Deze worden getoond in het device overzicht.
\item Bekijken van de actuele status van een device.
\item Rechtstreeks commando's sturen naar devices via het device overzicht. 
\item Ondersteuning voor 2 type devices: ZBS-110 (plug) en ZBS-121 (multimeter).
\item Ophalen van data in de achtergrond. Deze data is wat de verschillende devices als metingen teruggeven.
\item Overzicht waar je de opgehaalde data kan bekijken. Dit kan per kamer of over heel het systeem. Er kunnen waarden worden weggefilterd en er kan voor bepaalde tijdsperioden worden gekozen.
\item Zelf toevoegen van acties. Dit zijn regels die zelf kunnen worden samengesteld. Voor meer uitleg, zie gebruik\ref{sub:actions}.
\item Staat van het systeem wordt persistent opgeslagen. Devices, stewards, acties en data worden veilig opgeslagen. Moest het systeem falen, kan het bij opnieuw opstarten direct hervatten.
\item Stewards en majordomo overleven wanneer de connectie wegvalt. Deze zullen wachten tot er een nieuwe connectie kan worden opgesteld.
\item Mogelijkheid tot simuleren van stewards om te testen.
\end{itemize}
% subsection features (end)

\subsection{Installeren}
\label{sub:install}

Om het systeem te installeren is niet gebruik gemaakt van het racket packaging systeem omdat er verschillende files nodig zijn die niet gemakkelijk te packagen vallen. Ook is de hieronder beschreven methode geldig voor alle besturing systemen.
\begin{enumerate}
	\item Installeer Racket\footnote{http://download.racket-lang.org}. Het systeem is getest onder versie 6.0.
	\item Pak de code uit naar een bepaalde map.
	\item Open DrRacket, open het bestand \emph{start.rkt} en druk rechtsboven op \emph{Doen!}. 
	\item[3b.] Moest het systeem niet snel genoeg lopen, kan in mac en linux via de commandline het commando \lstinline|racket start.rkt| worden uitgevoerd vanaf de map waarin de code zich bevindt. 
	\item Een browser venster opent zich normaal met de interface. Indien dit niet het geval is kan er in een browser naar\\ \emph{http://localhost:8000/servlets/standalone.rkt} worden gesurfd.
\end{enumerate}

Om stewards te installeren moet het volgende worden gedaan.
\begin{enumerate}
	\item Kopi\"eer de code in de map \emph{Raspberry} naar de raspberry pi.
	\item Start via Televisie of scherm: 
	\begin{enumerate}
		\item Verbind je raspberry pi met een televisie of scherm. Zet hem aan.
		\item Connecteer de zigbee module.
		\item Login en ga via het cd (change directory) commando naar de map waarin je de inhoud van de map \emph{Raspberry} uit het archief hebt gekopi\"eerd.
		\item Om het ip adres te vinden, druk je het commando \emph{ifconfig} onder eth0 (bekabeld) of wlan0 (wireless), het adres achter "inet addr:" is het ip adres van je steward. De standaard poort is 12345.
		\item Voer het commando \emph{./slip} uit.
		\item Nu moet je de code inladen, dit doe je door \emph{(load "run")} te typen en enter te drukken. 
		\item Je mag de pi nu loskoppelen van het scherm.
	\end{enumerate}
	\item Start de pi via een draadloze ssh verbinding:
	\begin{enumerate}
		\item Sluit de pi aan en connecteer de zibee module.
		\item Het opstellen van de ssh connectie doe je door op je computer \emph{ssh pi@IPVANPI} in te geven.
		\item Hierna zijn stappen e tot g van punt 2 dezelfde.
	\end{enumerate}
	\item Voeg de nieuwe steward toe, door in de interface \emph{Stewards} te drukken. Onderaan de tabel kan je een nieuwe steward toevoegen.
\end{enumerate}
% subsection install (end)

\subsection{Gebruik}
\label{sub:usage}
Het gebruik van het systeem is vrij simpel. Wanneer het systeem wordt opgestart, wordt het start scherm weergegeven. Hierop is er een kleine uitleg over het gebruik van het systeem te vinden. In het menu staan, buiten de startpagina,  4 onderdelen. Deze worden elk hieronder uitgebreid besproken. \\

Op de pagina Stewards kan er een tabel met alle stewards die geconnecteerd zijn aan het systeem gevonden worden. Het ID is de manier waarop het systeem een steward identificeert. Het ip is het lokaal adres waarop de steward zich bevindt. Verder kan je de poort ook zien, deze is standaard 12345. De room is de kamer waarin de steward zich bevindt. Deze moet worden meegegeven bij het toevoegen vermits een raspberry pi onmogelijk zelf kan weten waar hij zich bevindt. Er kan ook de status van de steward worden gevonden. Deze staat in de kolom Amount of devices. Normaal toont deze hoeveel devices er verbonden zijn. Maar wanneer er een netwerk probleem is, of de steward is aan het opstarten zal er een status bericht worden weergegeven (bijvoorbeeld "OFFLINE" wanneer de steward onbereikbaar is).\\
Er kan ook een steward worden toegevoegd. Dit wordt gedaan door in de laatste kolom van de tabel de nodige informatie in te geven in de juiste kolom. Het systeem voegt deze steward dan toe en zal zelf mogelijke devices in de kamer zoeken.\\

De pagina Devices toont een tabel met alle slimme toestellen die ondersteunt worden (voorlopig enkel ZBS-110 en ZBS-121). Er kan verschillende informatie over elk toestel worden gelezen. Alsook een status bericht, dit toont in welke staat het toestel zich bevindt. Bij de ZBS-110 (plug) bijvoorbeeld zal er komen wat de werklast is en of het toestel aan staat of niet. \\
Het is ook mogelijk om rechtstreeks naar het toestel een bericht te sturen. Dit kan in de laatste kolom van de tabel. Merk wel op dat dit een tijdje kan duren, het systeem moet namelijk eerst de berichten die in de achtergrond worden verstuurt afronden en erna het gegeven bericht sturen. Het sturen van een bericht duurt gebruikelijk 10 seconden. Nadat het bericht is verstuurt verschijnt het resultaat in dezelfde kolom als waar het bericht is ingegeven. Merk op dat het systeem zelf toestellen detecteert en deze dus niet handmatig kunnen worden toegevoegd. Het instoppen van toestellen is voldoende.\\

Op de Actions pagina kunnen de acties worden beheert. Een actie bestaat uit een conditie, wanneer deze conditie waar is zal een bepaalde actie worden uitgevoerd. Elke actie heeft een source device, dit is een toestel waaruit de informatie voor de conditie wordt gelezen. De conditie bestaat uit een type, bij temperatuur is dit bijvoorbeeld "TEM"\footnote{Alle types kunnen worden teruggevonden bij de status van toestellen}. Er moet ook een waarde worden meegegeven (bijvoorbeeld 20, van $20\,^{\circ}\mathrm{C}$) en een gelijkheid (bijvoorbeeld kleiner dan).\\
Om de actie iets te laten uitvoeren met je een doeltoestel kiezen en een commando ingeven. Dit commando zal dan naar het toestel worden gestuurd wanneer de conditie waar is.\\
Een uitgewerkt voorbeeld: De elektrische verwarming (aangesloten op een slimme plug) moet worden aangezet wanneer de temperatuur onder de 15 graden zakt. Het type is TEM van temperatuur. De waarde is 15, het doeltoestel is de plug waarin de elektrische verwarming zit, het brontoestel (source device) is de multimeter die te temperatuur in de kamer meet en gelijkheid is kleiner dan ($<$).\\
Acties kunnen worden bekeken, verwijderd en toegevoegd op deze pagina.\\

De laatste pagina is de data pagina. Op deze staat een korte intro over de data, een lijst met alle kamers waarin er data is verzameld, een link naar de grafiek met alle verzamelde data en een paar feiten over het systeem. Wanneer er wordt verder gegaan naar de data over bijvoorbeeld de badkamer, wordt er een grafiek weergegeven 
% subsection usage (end)


\subsection{Screenshots}
\label{sub:screenshots}

% subsection screenshots (end)

% section users (end)


\end{document}
